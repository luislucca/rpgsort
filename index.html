<html><head><base href="/">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listas e Tabelas RPG</title>
    <link rel="stylesheet" href="main.css">
    </head>
<body>
    <div class="container">
        <h1>Minhas Listas RPG</h1>
        
        <div class="action-bar">
            <input type="text" id="listName" placeholder="Nome da nova lista">
            <select id="listType">
                <option value="simple">Lista Simples</option>
                <option value="table">Tabela</option>
            </select>
            <button onclick="createNewList()">Criar Nova Lista</button>
        </div>

        <div id="listContainer" style="display: flex; flex-wrap: wrap; gap: 15px; justify-content: flex-start;"></div>
    </div>

    <div id="listModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle"></h2>
            <div class="action-bar">
                <input type="text" id="itemInput" placeholder="Novo item">
                <button onclick="addItem()">Adicionar</button>
                <button onclick="rollRandomItem()">Sortear Item</button>
                <button onclick="closeModal()">Fechar</button>
                <div id="tableControls" style="display: none;">
                    <input type="text" id="columnName" placeholder="Nome da coluna">
                    <button onclick="addColumn()">Adicionar Coluna</button>
                </div>
            </div>
            <div class="dice-roll-area" id="rollResult"></div>
            <div id="listContent"></div>
        </div>
    </div>

<script>
let lists = [];
let currentList = null;
let menuCategories = [
    {id: 1, name: "Listas Simples", type: "simple"},
    {id: 2, name: "Tabelas", type: "table"}
];

function addNewMenu() {
    const menuName = prompt("Digite o nome do novo menu:");
    if (!menuName) return;
    
    menuCategories.push({
        id: Date.now(),
        name: menuName,
        type: 'custom'
    });
    updateListDisplay();
}

function editMenuName(menuId, event) {
    if (event) {
        event.stopPropagation();
    }
    const menu = menuCategories.find(m => m.id === menuId);
    if (!menu) return;
    
    const newName = prompt("Digite o novo nome do menu:", menu.name);
    if (!newName || newName === menu.name) return;
    
    menu.name = newName;
    updateListDisplay();
}

function moveListToMenu(listId, menuId) {
    const list = lists.find(l => l.id === listId);
    if (!list) return;
    
    list.menuId = menuId ? Number(menuId) : null;
    updateListDisplay();
}

function createNewList() {
    const name = document.getElementById('listName').value;
    const type = document.getElementById('listType').value;
    if (!name) return;
    
    const list = {
        id: Date.now(),
        name: name,
        type: type,
        items: [],
        columns: type === 'table' ? ['Item'] : null,
        menuId: null 
    };
    
    lists.push(list);
    updateListDisplay();
    document.getElementById('listName').value = '';
}

function updateListDisplay() {
    const container = document.getElementById('listContainer');
    
    if (lists.length === 0) {
        container.innerHTML = `
            <div style="text-align: center; padding: 40px; color: #666;">
                <h3>Nenhuma lista criada</h3>
                <p>Crie uma nova lista usando o formul√°rio acima</p>
            </div>
        `;
        return;
    }

    let html = `
        <div class="action-bar" style="margin-bottom: 20px;">
            <button onclick="addNewMenu()">Novo Menu</button>
        </div>
    `;

    menuCategories.forEach(menu => {
        const menuLists = lists.filter(l => {
            if (menu.type === 'custom') {
                return l.menuId === menu.id;
            } else {
                return l.menuId === null && l.type === menu.type;
            }
        });

        html += `
            <div class="list-dropdown">
                <div class="dropdown-header" onclick="toggleDropdown('menu-${menu.id}')">
                    <span style="flex: 1;">${menu.name} (${menuLists.length})</span>
                    ${menu.type === 'custom' ? `
                        <button onclick="editMenuName(${menu.id}, event)" 
                                style="margin-left: 10px; padding: 2px 8px;">
                            Editar Nome
                        </button>
                    ` : ''}
                </div>
                <div id="menu-${menu.id}" class="dropdown-content">
                    ${menuLists.length === 0 ? `
                        <div style="padding: 10px; text-align: center; color: #666;">
                            Nenhuma lista neste menu
                        </div>
                    ` : ''}
                    ${menuLists.map(list => `
                        <div class="list-card">
                            <div class="list-card-content">
                                <h3>${list.name}</h3>
                                <p>${list.items.length} ${list.items.length === 1 ? 'item' : 'itens'}</p>
                            </div>
                            <div class="list-actions">
                                <select onchange="moveListToMenu(${list.id}, this.value)" 
                                        onclick="event.stopPropagation()">
                                    <option value="">Mover para...</option>
                                    ${menuCategories.map(m => 
                                        `<option value="${m.id}" ${list.menuId === m.id ? 'selected' : ''}>
                                            ${m.name}
                                        </option>`
                                    ).join('')}
                                </select>
                                <button onclick="editListName(${list.id}, event)">Editar Nome</button>
                                <button onclick="openList(${list.id})">Abrir</button>
                                <button onclick="deleteList(${list.id})">Excluir</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function moveItem(index, direction) {
  if (direction === -1 && index === 0 || direction === 1 && index === currentList.items.length - 1) {
    return;
  }
  const newIndex = index + direction;
  [currentList.items[index], currentList.items[newIndex]] = [currentList.items[newIndex], currentList.items[index]];
  updateListContent();
}

function moveColumn(index, direction) {
  if (direction === -1 && index === 0 || direction === 1 && index === currentList.columns.length - 1) {
    return;
  }
  const newIndex = index + direction;
  [currentList.columns[index], currentList.columns[newIndex]] = [currentList.columns[newIndex], currentList.columns[index]];
  currentList.items.forEach(item => {
    const values = currentList.columns.map(col => item[col]);
    currentList.columns.forEach((col, i) => {
      item[col] = values[i];
    });
  });
  updateListContent();
}

function editColumnHeader(index) {
  const newHeader = prompt('Digite o novo nome da coluna:', currentList.columns[index]);
  if (!newHeader || newHeader === currentList.columns[index]) return;
  currentList.items.forEach(item => {
    item[newHeader] = item[currentList.columns[index]];
    delete item[currentList.columns[index]];
  });
  currentList.columns[index] = newHeader;
  updateListContent();
}

function updateListContent() {
  const content = document.getElementById('listContent');
  if (currentList.type === 'simple') {
    content.innerHTML = `
            <div id="simpleList">
                ${currentList.items.map((item, index) => `
                    <div class="list-card" id="item-${index}">
                        <span>${index + 1}. ${item.name}</span>
                        <div class="row-actions">
                            <button onclick="moveItem(${index}, -1)" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
                            <button onclick="moveItem(${index}, 1)" ${index === currentList.items.length - 1 ? 'disabled' : ''}>‚Üì</button>
                            <button onclick="removeItem(${index})">Remover</button>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
  } else {
    content.innerHTML = `
            <table>
                <thead>
                    <tr>
                        <th>N√∫mero</th>
                        ${currentList.columns.map((col, index) => `
                            <th>
                                <div class="column-header">
                                    <span class="edit-column-header" onclick="editColumnHeader(${index})">${col}</span>
                                    <div class="column-actions">
                                        <button onclick="moveColumn(${index}, -1)" ${index === 0 ? 'disabled' : ''}>‚Üê</button>
                                        <button onclick="moveColumn(${index}, 1)" ${index === currentList.columns.length - 1 ? 'disabled' : ''}>‚Üí</button>
                                        <button class="column-roll-button" onclick="rollColumnItems(${index})">üé≤</button>
                                    </div>
                                </div>
                            </th>
                        `).join('')}
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody>
                    ${currentList.items.map((item, index) => `
                        <tr id="item-${index}">
                            <td>${index + 1}</td>
                            ${currentList.columns.map(col => `
                                <td contenteditable="true" onblur="updateCellContent(${index}, '${col}', this.textContent)">${item[col] || ''}</td>
                            `).join('')}
                            <td>
                                <div class="row-actions">
                                    <button onclick="moveItem(${index}, -1)" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
                                    <button onclick="moveItem(${index}, 1)" ${index === currentList.items.length - 1 ? 'disabled' : ''}>‚Üì</button>
                                    <button onclick="removeItem(${index})">Remover</button>
                                </div>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
  }
}

function openList(id) {
  currentList = lists.find(l => l.id === id);
  const modal = document.getElementById('listModal');
  const modalTitle = document.getElementById('modalTitle');
  const rollResult = document.getElementById('rollResult');
  const tableControls = document.getElementById('tableControls');
  const itemInput = document.getElementById('itemInput');
  const addButton = document.querySelector('button[onclick="addItem()"]');
  modalTitle.textContent = currentList.name;
  rollResult.textContent = '';
  tableControls.style.display = currentList.type === 'table' ? 'block' : 'none';
  if (currentList.type === 'table') {
    itemInput.style.display = 'none';
    addButton.textContent = 'Incluir Linha';
  } else {
    itemInput.style.display = 'block';
    itemInput.placeholder = 'Novo item';
    addButton.textContent = 'Adicionar';
  }
  updateListContent();
  modal.style.display = 'flex';
}

function addItem() {
  const itemInput = document.getElementById('itemInput');
  const name = itemInput.value;
  if (currentList.type === 'simple') {
    if (!name) return;
    currentList.items.push({
      name: name
    });
  } else {
    const item = {};
    currentList.columns.forEach(col => {
      item[col] = '';
    });
    currentList.items.push(item);
  }
  itemInput.value = '';
  updateListContent();
}

function addColumn() {
  const columnName = document.getElementById('columnName').value;
  if (!columnName || currentList.columns.includes(columnName)) return;
  currentList.columns.push(columnName);
  currentList.items.forEach(item => {
    item[columnName] = '';
  });
  document.getElementById('columnName').value = '';
  updateListContent();
}

function rollRandomItem() {
  if (!currentList.items.length) {
    document.getElementById('rollResult').textContent = 'A lista est√° vazia!';
    return;
  }
  const previousSelected = document.querySelector('.selected');
  if (previousSelected) {
    previousSelected.classList.remove('selected');
  }
  const randomIndex = Math.floor(Math.random() * currentList.items.length);
  const selectedItem = currentList.items[randomIndex];
  document.getElementById('rollResult').innerHTML = `
        <h3>Resultado do Sorteio:</h3>
        <p class="selected-item">Item ${randomIndex + 1}: ${selectedItem.name || selectedItem.Item}</p>
    `;
  const itemElement = document.getElementById(`item-${randomIndex}`);
  if (itemElement) {
    itemElement.classList.add('selected');
    itemElement.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
  }
}

function removeItem(index) {
  currentList.items.splice(index, 1);
  updateListContent();
}

function deleteList(id) {
  lists = lists.filter(l => l.id !== id);
  updateListDisplay();
}

function closeModal() {
  document.getElementById('listModal').style.display = 'none';
  currentList = null;
}

function updateCellContent(rowIndex, column, content) {
  currentList.items[rowIndex][column] = content;
}

function rollColumnItems(columnIndex) {
  if (!currentList.items.length) {
    document.getElementById('rollResult').textContent = 'A lista est√° vazia!';
    return;
  }
  const previousSelected = document.querySelector('.selected');
  if (previousSelected) {
    previousSelected.classList.remove('selected');
  }
  const columnName = currentList.columns[columnIndex];
  const randomIndex = Math.floor(Math.random() * currentList.items.length);
  const selectedItem = currentList.items[randomIndex];
  document.getElementById('rollResult').innerHTML = `
    <h3>Resultado do Sorteio da Coluna "${columnName}":</h3>
    <p class="selected-item">Item ${randomIndex + 1}: ${selectedItem[columnName] || ''}</p>
  `;
  const itemElement = document.getElementById(`item-${randomIndex}`);
  if (itemElement) {
    itemElement.classList.add('selected');
    itemElement.scrollIntoView({
      behavior: 'smooth',
      block: 'center'
    });
  }
}

function editListName(listId, event) {
  if (event) {
    event.stopPropagation();
  }
  const list = lists.find(l => l.id === listId);
  const newName = prompt('Digite o novo nome:', list.name);
  if (!newName || newName === list.name) return;
  list.name = newName;
  updateListDisplay();
}

function toggleDropdown(id) {
  const content = document.getElementById(id);
  if (!content) return;
  
  const allDropdowns = document.querySelectorAll('.dropdown-content');
  allDropdowns.forEach(dropdown => {
    if (dropdown.id !== id && dropdown.classList.contains('show')) {
      dropdown.classList.remove('show');
    }
  });
  
  content.classList.toggle('show');
}
</script>
</body>
</html>